commit 3a693ef7d5a949796274f42c7c5e67b933d6ed8f
Author: Richard Hughes <richard@hughsie.com>
Date:   Sat Aug 13 19:08:54 2011 +0200

    Add a configure argument --enable-volume-search
    
    This allows distros to disable the external-volume probing, which may be
    slightly more secure at the expense of some 'just-workingness'.

Index: colord/configure.ac
===================================================================
--- colord.orig/configure.ac	2011-08-24 13:44:15.000000000 +1000
+++ colord/configure.ac	2011-08-24 13:47:57.166591324 +1000
@@ -215,6 +215,16 @@
 	AC_DEFINE(HAVE_SANE,1,[Use SANE support for detecting scanners])
 fi
 
+dnl **** Daemon is allowed to do search external volumes for profiles ****
+AC_ARG_ENABLE(volume_search, AS_HELP_STRING([--enable-volume-search],[Enable profile volume search]),
+	      enable_volume_search=$enableval, enable_volume_search=yes)
+tmp="false"
+if test x$enable_volume_search != xno; then
+	tmp="true"
+fi
+AC_DEFINE_UNQUOTED(ENABLE_VOLUME_SEARCH, "$tmp", [enable volume search])
+AC_SUBST(ENABLE_VOLUME_SEARCH, "$tmp")
+
 dnl ---------------------------------------------------------------------------
 dnl - Build VALA support
 dnl ---------------------------------------------------------------------------
@@ -281,6 +291,7 @@
         gobject-introspection:     ${found_introspection}
         PolicyKit support:         ${enable_polkit}
         Reverse engineering tools: ${enable_reverse}
+        External volume searching: ${enable_volume_search}
         SANE support:              ${has_sane}
         GUDEV support:             ${enable_gudev}
         LCMS2 DICT support:        ${has_new_lcms}
Index: colord/etc/Makefile.am
===================================================================
--- colord.orig/etc/Makefile.am	2011-08-24 13:44:15.000000000 +1000
+++ colord/etc/Makefile.am	2011-08-24 13:47:19.956590931 +1000
@@ -1,7 +1,14 @@
 configdir = $(sysconfdir)
-config_DATA = colord.conf
+config_in_files = colord.conf.in
+config_DATA = $(config_in_files:.conf.in=.conf)
 
-EXTRA_DIST =						\
-	$(config_DATA)
+$(config_DATA): $(config_in_files) Makefile
+	@sed -e "s|\@enablevolumesearch\@|$(ENABLE_VOLUME_SEARCH)|" $< > $@
+
+EXTRA_DIST =							\
+	$(config_in_files)
+
+CLEANFILES =							\
+	colord.conf
 
 -include $(top_srcdir)/git.mk
Index: colord/etc/colord.conf
===================================================================
--- colord.orig/etc/colord.conf	2011-08-24 13:44:15.000000000 +1000
+++ /dev/null	1970-01-01 00:00:00.000000000 +0000
@@ -1,24 +0,0 @@
-[colord]
-
-# This controls whether we search external volumes for color profiles.
-#
-# default=true
-SearchVolumes=true
-
-# If we should use SANE to add scanner and camera devices.
-#
-# default=true
-UseSANE=true
-
-# If we should create a dummy sensor for testing
-#
-# default=false
-CreateDummySensor=false
-
-# Known profiles are specific colorspaces that applications may request,
-# e.g. 'AdobeRGB' or 'sRGB'.
-# This key sets up any manual overrides that are not automatically added
-# using the profile dictionary metadata.
-#
-# default=
-StandardSpaces=adobe-rgb:/usr/share/color/icc/Argyll/ClayRGB1998.icm;srgb:/usr/share/color/icc/Argyll/sRGB.icm;prophoto-rgb:/usr/share/color/icc/Argyll/ProPhotoRGB.icc
Index: colord/etc/colord.conf.in
===================================================================
--- /dev/null	1970-01-01 00:00:00.000000000 +0000
+++ colord/etc/colord.conf.in	2011-08-24 13:47:19.956590931 +1000
@@ -0,0 +1,24 @@
+[colord]
+
+# This controls whether we search external volumes for color profiles.
+#
+# default=@enablevolumesearch@
+SearchVolumes=@enablevolumesearch@
+
+# If we should use SANE to add scanner and camera devices.
+#
+# default=true
+UseSANE=true
+
+# If we should create a dummy sensor for testing
+#
+# default=false
+CreateDummySensor=false
+
+# Known profiles are specific colorspaces that applications may request,
+# e.g. 'AdobeRGB' or 'sRGB'.
+# This key sets up any manual overrides that are not automatically added
+# using the profile dictionary metadata.
+#
+# default=
+StandardSpaces=adobe-rgb:/usr/share/color/icc/Argyll/ClayRGB1998.icm;srgb:/usr/share/color/icc/Argyll/sRGB.icm;prophoto-rgb:/usr/share/color/icc/Argyll/ProPhotoRGB.icc
